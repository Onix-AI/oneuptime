_id: f2898958-784b-42c3-adac-712e3ed02dd8
name: AWS
description: Monitors AWS service health via RSS feed
slug: aws-2387254843
monitorType: Custom JavaScript Code
monitoringInterval: "*/5 * * * *"  # every 5 min
defaultMonitorStatusId: 7f2ba4b8-50a9-4f65-ad5e-0ae5f08dc4e3  # Operational
criteria:
  - name: Check for a critical outage
    description: Checks for a critical-impact incident
    monitorStatusId: e1aeeeb0-25d8-4915-837e-21828ece73d1  # Offline
    filterCondition: Any
    filters:
      - checkOn: Result Value
        filterType: Contains
        value: "[OFFLINE:critical]"
    changeMonitorStatus: true
    createIncidents: true
    createAlerts: false
    incidents:
      - title: "{{result.title}}"
        description: |
          **Status:** {{result.description}}

          **Incident:** {{result.data.incident.name}}
          - Impact: {{result.data.incident.impact}}
          - Status: {{result.data.incident.status}}
          - Link: {{result.data.incident.link}}

          **Update:** {{result.data.incident.update}}

          **Active Issues:** {{result.data.incidentCount}} incident(s), {{result.data.maintenanceCount}} maintenance(s)

          [View Status Page]({{result.url}})
        incidentSeverityId: f0eafec9-9669-4095-a33d-7a1e52661f89  # Critical
        autoResolveIncident: true
  - name: Check for a major outage
    description: Checks for a major-impact incident
    monitorStatusId: e1aeeeb0-25d8-4915-837e-21828ece73d1  # Offline
    filterCondition: Any
    filters:
      - checkOn: Result Value
        filterType: Contains
        value: "[OFFLINE:major]"
    changeMonitorStatus: true
    createIncidents: true
    createAlerts: false
    incidents:
      - title: "{{result.title}}"
        description: |
          **Status:** {{result.description}}

          **Incident:** {{result.data.incident.name}}
          - Impact: {{result.data.incident.impact}}
          - Status: {{result.data.incident.status}}
          - Link: {{result.data.incident.link}}

          **Update:** {{result.data.incident.update}}

          **Active Issues:** {{result.data.incidentCount}} incident(s), {{result.data.maintenanceCount}} maintenance(s)

          [View Status Page]({{result.url}})
        incidentSeverityId: 9c2903e7-920d-405e-8f0c-a603ae5cd58d  # Major
        autoResolveIncident: true
  - name: Check if is degraded
    description: Checks for minor issues
    monitorStatusId: 29dfb8f0-9298-4fba-9c7a-9532c27ecd24  # Degraded
    filterCondition: Any
    filters:
      - checkOn: Result Value
        filterType: Contains
        value: "[DEGRADED]"
    changeMonitorStatus: true
    createIncidents: false
    createAlerts: false
  - name: Check if status check failed
    description: Detects when the RSS feed is unreachable
    monitorStatusId: 29dfb8f0-9298-4fba-9c7a-9532c27ecd24  # Degraded
    filterCondition: Any
    filters:
      - checkOn: Error
        filterType: Is Not Empty
    changeMonitorStatus: true
    createIncidents: true
    createAlerts: false
    incidents:
      - title: "AWS - Status Check Failed"
        description: Unable to reach the AWS health RSS feed. The service may still be operational.
        incidentSeverityId: 126b94dd-03a8-4c05-9b6d-d4bbc86e778b  # Warning
        autoResolveIncident: true
customCode: |
  const response = await axios.get('https://status.aws.amazon.com/rss/all.rss', { responseType: 'text' });
  const xml = response.data;

  // Extract all <item> elements from the RSS feed
  const itemMatches = xml.match(/<item>[\s\S]*?<\/item>/gi) || [];

  let status, description;
  let firstTitle = '';
  let firstDescription = '';

  if (itemMatches.length === 0) {
    status = '[OPERATIONAL]';
    description = 'All Services Operational';
  } else {
    // Extract title and description from the first item
    const titleMatch = itemMatches[0].match(/<title><!\[CDATA\[(.*?)\]\]>|<title>(.*?)<\/title>/i);
    firstTitle = titleMatch ? (titleMatch[1] || titleMatch[2] || '').trim() : '';

    const descMatch = itemMatches[0].match(/<description><!\[CDATA\[(.*?)\]\]>|<description>(.*?)<\/description>/i);
    firstDescription = descMatch ? (descMatch[1] || descMatch[2] || '').trim() : '';

    const combinedText = (firstTitle + ' ' + firstDescription).toLowerCase();

    if (/disruption|outage/.test(combinedText)) {
      status = '[OFFLINE:critical]';
      description = 'Service Disruption Detected';
    } else {
      status = '[DEGRADED]';
      description = 'Active Issues Reported';
    }
  }

  return { data: {
    status,
    title: `AWS - ${description}`,
    description,
    url: 'https://health.aws.amazon.com/health/status',
    data: {
      incidentCount: itemMatches.length,
      maintenanceCount: 0,
      incident: itemMatches.length > 0 ? {
        name: firstTitle,
        impact: status === '[OFFLINE:critical]' ? 'critical' : 'minor',
        status: 'active',
        link: 'https://health.aws.amazon.com/health/status',
        update: firstDescription.substring(0, 300)
      } : null
    }
  }};
